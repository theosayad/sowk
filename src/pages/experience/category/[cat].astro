---
import Layout from '../../../layouts/Default.astro';
import activities from '../../../data/activities.json' assert { type: 'json' };

/** helper to turn “My Category” → “my-category” */
const slugify = (s: string) =>
  s
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)/g, '');

/** Required for dynamic routes: generate a page for each category slug */
export async function getStaticPaths() {
  const categories = [
    ...new Set(activities.map((a) => a.category).filter(Boolean))
  ];
  return categories.map((cat) => ({
    params: { cat: slugify(cat) }
  }));
}

// Grab the slug from the URL
const { cat } = Astro.params;

// Recover the original category name
const decodedCategory = [
  ...new Set(activities.map((a) => a.category).filter(Boolean))
].find((c) => slugify(c) === cat);
---

<Layout title={`Experience · ${decodedCategory}`}>
  <section class="experience-hero">
    <h1>Things to do in &amp; around {decodedCategory}</h1>
  </section>

  <div class="experience-grid">
    {activities
      .filter((a) => a.category === decodedCategory)
      .map((a) => (
        <a href={`/experience/${a.slug}`} class="experience-card">
          <img
            src={a.image}
            alt={a.name}
            class="experience-thumb"
            loading="lazy"
            width="300"
            height="200"
          />
          <h3>{a.name}</h3>
          <p class="experience-meta">{a.distance.toFixed(1)} km away</p>
          <span class="experience-link">More info ↗</span>
        </a>
    ))}
  </div>
</Layout>

<style>
  body, h1, h3, p, a { font-family: 'Poppins', sans-serif; }

  .experience-hero    { text-align:center; margin:4rem 0 2rem; }
  .experience-hero h1 { font-size:2.2rem; font-weight:700; }

  .experience-grid {
    display: grid;
    gap: 2rem;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    padding: 0 2rem;
  }

  .experience-card {
    background:#fff;
    border-radius:0.75rem;
    overflow:hidden;
    box-shadow:0 12px 32px rgba(0,0,0,0.06);
    display:flex;
    flex-direction:column;
    cursor:pointer;
    transition:transform .2s ease;
  }
  .experience-card:hover { transform:translateY(-4px); }

  .experience-thumb { width:100%; height:160px; object-fit:cover; }

  .experience-card h3 {
    font-size:1.1rem;
    font-weight:600;
    margin:0.75rem 1rem 0.25rem;
  }
  .experience-meta {
    font-size:0.85rem;
    color:#667;
    margin:0 1rem 0.75rem;
  }
  .experience-link {
    margin: auto 1rem 1rem;
    font-size:0.9rem;
    font-weight:600;
    color:#c89a2a;
    text-decoration:none;
  }
  .experience-link:hover { text-decoration:underline; }
</style>
