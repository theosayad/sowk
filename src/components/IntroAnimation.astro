---
/* IntroAnimation component */
---
<!-- 1️⃣ p5.js removed—pure CSS/JS stop-motion -->
<style>
  /* ────────── container ────────── */
  .stopmotion-intro {
    position: fixed; inset: 0;
    background: #f8f9fa;
    display: flex; flex-direction: column;
    align-items: center; gap: 1.5rem;
    overflow: hidden; z-index: 1000;
    padding-top: 2rem;
    font-family: 'Comic Sans MS', cursive;
  }

  /* ────────── typewriter text ────────── */
  .typewriter {
    white-space: nowrap; overflow: hidden;
    border-right: 3px solid #4a5568;
    font-size: clamp(1rem,4vw,1.8rem);
    color: #2d3748;
    max-width: 90%; text-align: center;
    animation:
      typing 5s steps(62,end) 1 forwards,
      blink 0.8s step-end infinite;
    z-index: 1;
  }
  @keyframes typing { from { width: 0 } to { width: 100% } }
  @keyframes blink  { 50% { border-color: transparent } }

  /* ────────── stop-motion frame ────────── */
  .sm-container {
    position: relative; width: 500px; height: auto;
    overflow: hidden; z-index: 1;
  }
  .sm-img {
    display: block;
    width: 100%;
    transform: translateX(-100%);
    /* initial off-screen */
  }
  .sm-img.drive-in {
    transition: transform 2s ease-out;
    transform: translateX(0);
  }
  .sm-img.drive-out {
    transition: transform 2s ease-in;
    transform: translateX(100%);
  }

  /* ────────── fade-out ────────── */
  .stopmotion-intro.fade-out {
    animation: fadeOut 1s ease-out forwards;
  }
  @keyframes fadeOut {
    to { opacity: 0; pointer-events: none; }
  }
</style>

<div class="stopmotion-intro" id="intro">
  <!-- 2️⃣ Text line -->
  <div class="typewriter" id="typewriter">
    Hi there! From here onwards, please drop off all your worries.
  </div>

  <!-- 3️⃣ Stop-motion image -->
  <div class="sm-container">
    <img
      id="sm-img"
      class="sm-img"
      src="/images/intro/truck.png"
      alt="stop-motion truck frame"
    />
  </div>
</div>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const intro = document.getElementById('intro');
    const typer = document.getElementById('typewriter');
    const img   = document.getElementById('sm-img');

    /** 0️⃣ Only once per session **/
    if (sessionStorage.getItem('introPlayed')) {
      intro.remove();
      return;
    }
    sessionStorage.setItem('introPlayed','true');

    /** 1️⃣ When text finishes typing (5s), drive in **/
    const typingTime = 5000;
    setTimeout(() => {
      img.classList.add('drive-in');

      /** 2️⃣ After drive-in (2s), wait 0.5s then drop worries **/
      setTimeout(() => {
        const dropFrames = [
          '/images/intro/worries falling into truck.png',
          '/images/intro/worries falling into truck-2.png',
          '/images/intro/truck with worries.png'
        ];
        let idx = 0;

        function nextDrop() {
          if (idx < dropFrames.length) {
            img.src = dropFrames[idx++];
            // show each frame 0.8s apart
            setTimeout(nextDrop, 800);
          } else {
            /** 3️⃣ Hold loaded truck 1s, then drive out **/
            setTimeout(() => {
              img.classList.add('drive-out');
              /** 4️⃣ Fade entire intro 2s later **/
              setTimeout(() => {
                intro.classList.add('fade-out');
                setTimeout(() => intro.remove(), 1000);
              }, 2000);
            }, 1000);
          }
        }

        nextDrop();
      }, 2500);

    }, typingTime);
  });
</script>
