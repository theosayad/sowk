---
/* IntroAnimation component: typewriter + stop-motion dump-truck animation */
---
<style>
  .intro-container {
    position: fixed;
    inset: 0;
    background: #f8f9fa;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    font-family: 'Comic Sans MS', cursive, sans-serif;
  }

  .typewriter {
    font-size: clamp(1rem, 4vw, 1.8rem);
    color: #2d3748;
    white-space: nowrap;
    overflow: hidden;
    width: 90%;
    max-width: 600px;
    margin: 0 auto 2rem;
    padding: 0.5rem;
    box-sizing: border-box;
    text-align: center;
  }

  .typewriter-text {
    display: inline-block;
    white-space: nowrap;
    border-right: 3px solid #4a5568;
    padding-right: 5px;
    animation: typing-realistic 6s steps(60) forwards, blink 0.8s step-end infinite;
  }

  @keyframes typing-realistic {
    0% { width: 0; }
    15% { width: 15%; }
    20% { width: 15%; } /* pause after "Hi there!" */
    25% { width: 20%; }
    60% { width: 85%; }
    65% { width: 85%; } /* pause after period */
    100% { width: 100%; }
  }

  @keyframes blink {
    50% { border-color: transparent; }
  }

  .truck-scene {
    position: relative;
    width: 500px;
    height: 300px;
    overflow: visible;
  }

  /* Simple truck that's always visible */
  .truck-container {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .truck-svg {
    width: 100%;
    height: 100%;
    display: block;
  }

  /* Dump bed animation */
  .dump-bed {
    transform-origin: 180px 120px;
    transition: transform 1s ease-in-out;
  }

  .dump-bed.dumping {
    transform: rotate(-45deg);
  }

  /* Letter physics */
  .letter {
    position: absolute;
    font-family: 'Comic Sans MS', cursive;
    font-weight: bold;
    font-size: 2rem;
    color: #e53e3e;
    z-index: 10;
    pointer-events: none;
    opacity: 0;
    user-select: none;
    transition: all 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .letter.falling {
    opacity: 1;
  }

  /* Truck exit animation */
  .truck-container.driving-away {
    animation: drive-away 3s ease-in forwards;
    animation-delay: 9s;
  }

  @keyframes drive-away {
    to { transform: translateX(120vw); }
  }

  /* Fade out */
  .intro-container.fade-out {
    animation: fade-out 1s ease-out forwards;
  }

  @keyframes fade-out {
    to {
      opacity: 0;
      pointer-events: none;
    }
  }
</style>

<div class="intro-container" id="introContainer">
  <div class="typewriter">
    <span class="typewriter-text" id="typewriterText">Hi there! From here onwards, please drop off all your worries.</span>
  </div>
  
  <div class="truck-scene">
    <div class="truck-container" id="truckContainer">
      <svg class="truck-svg" viewBox="0 0 500 300">
        <!-- Truck body - kids drawing style -->
        <g stroke="#000000" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <!-- Wheels -->
          <circle cx="100" cy="250" r="40" fill="#333333"/>
          <circle cx="400" cy="250" r="40" fill="#333333"/>
          
          <!-- Truck body -->
          <path d="M50 250 L450 250 L450 100 L350 100 L300 50 L150 50 L100 100 L50 100 Z" fill="#FF6B6B"/>
          
          <!-- Dump bed -->
          <g class="dump-bed" id="dumpBed">
            <path d="M150 100 L450 100 L450 50 L200 50 Z" fill="#FFD93D"/>
          </g>
          
          <!-- Cab -->
          <rect x="50" y="100" width="100" height="150" fill="#4ECDC4"/>
          
          <!-- Window -->
          <rect x="70" y="120" width="60" height="80" fill="#F8F3D4"/>
          
          <!-- Details -->
          <line x1="70" y1="220" x2="130" y2="220" stroke="#000000" stroke-width="6"/> <!-- Grill -->
        </g>
      </svg>
    </div>

    <!-- Letters container for physics simulation -->
    <div id="letterContainer"></div>
  </div>
</div>

<script>
(function() {
  // Check if intro was already played this session
  if (sessionStorage.getItem('introPlayed')) {
    const container = document.getElementById('introContainer');
    if (container) container.remove();
    return;
  }

  // Mark as played
  sessionStorage.setItem('introPlayed', 'true');

  const introContainer = document.getElementById('introContainer');
  const truckContainer = document.getElementById('truckContainer');
  const letterContainer = document.getElementById('letterContainer');
  const dumpBed = document.getElementById('dumpBed');

  // Extract letters from typewriter text and animate them
  function extractAndDumpLetters() {
    const typewriterEl = document.getElementById('typewriterText');
    
    const fullText = typewriterEl.textContent;
    const wordToExtract = 'worries';
    const letters = wordToExtract.split('');
    
    const newText = fullText.replace(wordToExtract, '______');
    typewriterEl.textContent = newText;
    
    const bedText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    bedText.setAttribute('x', '130');
    bedText.setAttribute('y', '125');
    bedText.setAttribute('font-family', 'Comic Sans MS');
    bedText.setAttribute('font-size', '16');
    bedText.setAttribute('fill', '#e53e3e');
    bedText.setAttribute('text-anchor', 'middle');
    bedText.textContent = wordToExtract;
    dumpBed.appendChild(bedText);
    
    setTimeout(() => {
      dumpBed.classList.add('dumping');
    }, 1000);

    setTimeout(() => {
      bedText.remove();
      
      letters.forEach((char, index) => {
        const letterEl = document.createElement('div');
        letterEl.className = 'letter';
        letterEl.textContent = char;
        
        const startX = 130;
        const startY = 120;
        
        letterEl.style.left = `${startX}px`;
        letterEl.style.top = `${startY}px`;
        
        letterContainer.appendChild(letterEl);

        setTimeout(() => {
          const horizontalSpread = (index - (letters.length - 1) / 2) * 40;
          const verticalDrop = Math.random() * 30 + 150; // 150-180px drop
          const rotation = (Math.random() - 0.5) * 360;

          letterEl.style.transform = `translate(${horizontalSpread}px, ${verticalDrop}px) rotate(${rotation}deg)`;
          letterEl.classList.add('falling');
        }, 50); // Short delay for visual effect
      });
    }, 2000);
  }

  // Animation timeline
  setTimeout(extractAndDumpLetters, 7000); // Wait for typing to finish

  setTimeout(() => {
    // Start truck driving away
    if (truckContainer) {
      truckContainer.classList.add('driving-away');
    }
  }, 12000);

  setTimeout(() => {
    // Fade out everything
    if (introContainer) {
      introContainer.classList.add('fade-out');
      setTimeout(() => {
        introContainer.remove();
      }, 1000);
    }
  }, 16000);

})();
</script>
