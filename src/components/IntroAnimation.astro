---
/* IntroAnimation component */
---
<style>
  /* ─── Global white background ─── */
  html, body {
    margin: 0; padding: 0;
    background: #ffffff;
    height: 100%;
  }

  /* ─── Intro container ─── */
  .stopmotion-intro {
    position: fixed; inset: 0;
    background: #ffffff;
    display: flex; flex-direction: column;
    align-items: center; gap: 1.5rem;
    padding: 2rem 1rem 1rem;
    overflow: hidden; z-index: 1000;
    box-sizing: border-box;
  }

  /* ─── Header image sizing ─── */
  .header-img {
    width: 80%; max-width: 600px;
    height: auto; display: block;
    z-index: 2;
  }

  /* ─── Stop-motion truck container ─── */
  .sm-container {
    position: relative;
    width: 90%; max-width: 500px;
    overflow: visible; z-index: 1;
  }

  .sm-img {
    display: block; width: 100%;
    transform: translateX(-120%);
  }
  .sm-img.drive-in {
    transition: transform 2s ease-out;
    transform: translateX(0);
  }
  .sm-img.drive-out {
    transition: transform 2s ease-in;
    transform: translateX(120%);
  }

  /* ─── Fade-out at end ─── */
  .stopmotion-intro.fade-out {
    animation: fadeOut 1s ease-out forwards;
  }
  @keyframes fadeOut {
    to { opacity: 0; pointer-events: none; }
  }

  /* ─── Responsive tweaks ─── */
  @media (max-width: 600px) {
    .header-img { width: 90%; }
    .sm-container { width: 95%; max-width: none; }
  }
</style>

<div class="stopmotion-intro" id="intro">
  <!-- 1️⃣ Hand-drawn header -->
  <img
    id="headerImg"
    class="header-img"
    src="/images/header%20text.png"
    alt="Hi! Please drop off all your WORRIES before entering"
  />

  <!-- 2️⃣ Stop-motion truck -->
  <div class="sm-container">
    <img
      id="smImg"
      class="sm-img"
      src="/images/truck.png"
      alt="hand-drawn dump truck"
    />
  </div>
</div>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const intro     = document.getElementById('intro');
    const headerImg = document.getElementById('headerImg');
    const smImg     = document.getElementById('smImg');

    // Only once per session
    if (sessionStorage.getItem('introPlayed')) {
      intro.remove();
      return;
    }
    sessionStorage.setItem('introPlayed','true');

    // ─── 1️⃣ Header-fall sequence ───
    const headerFrames    = [
      '/images/header%20text%20falling1.png',
      '/images/header%20text%20falling2.png',
      '/images/header%20text%20worries%20fell.png'
    ];
    const frameTime       = 800;  // ms per header frame
    const headerPause     = 500;  // ms after last header frame

    headerFrames.forEach((src, idx) => {
      setTimeout(() => { headerImg.src = src; }, idx * frameTime);
    });

    // After header frames + pause, start truck sequence
    const headerTotal = headerFrames.length * frameTime + headerPause;
    setTimeout(() => {
      // ─── 2️⃣ Truck drives in ───
      smImg.classList.add('drive-in');

      // ─── 3️⃣ Drop-worries sequence ───
      const dropFrames   = [
        '/images/worries%20falling%20into%20truck.png',
        '/images/worries%20falling%20into%20truck-2.png',
        '/images/truck%20with%20worries.png'
      ];
      const dropInterval = 800;  // ms between drop frames
      const drivePause   = 300;  // ms after drive-in

      setTimeout(() => {
        dropFrames.forEach((src, i) => {
          setTimeout(() => { smImg.src = src; }, i * dropInterval);
        });

        // ─── 4️⃣ Truck drives out after drops + 1s hold ───
        const totalDropTime = dropFrames.length * dropInterval;
        setTimeout(() => {
          smImg.classList.add('drive-out');

          // ─── 5️⃣ Fade intro out 2s later ───
          setTimeout(() => {
            intro.classList.add('fade-out');
            setTimeout(() => intro.remove(), 1000);
          }, 2000);
        }, totalDropTime + 1000);

      }, 2000 + drivePause);

    }, headerTotal);
  });
</script>
