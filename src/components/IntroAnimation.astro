---
/* IntroAnimation component */
---
<style>
  /* ─── Global white background ─── */
  html, body {
    margin: 0;
    padding: 0;
    background: #ffffff;
    height: 100%;
  }

  /* ─── Intro container ─── */
  .stopmotion-intro {
    position: fixed; inset: 0;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding: 2rem 1rem 1rem;
    overflow: hidden;
    z-index: 1000;
    box-sizing: border-box;
  }

  /* ─── Header image sizing ─── */
  .header-img {
    width: 80%;
    max-width: 600px;
    height: auto;
    display: block;
    z-index: 2;
  }

  /* ─── Stop-motion truck container ─── */
  .sm-container {
    position: relative;
    width: 90%;
    max-width: 500px;
    overflow: visible;    /* show full wheels */
    z-index: 1;
  }

  .sm-img {
    display: block;
    width: 100%;
    transform: translateX(-120%); /* start off-screen */
  }
  .sm-img.drive-in {
    transition: transform 2s ease-out;
    transform: translateX(0);
  }
  .sm-img.drive-out {
    transition: transform 2s ease-in;
    transform: translateX(120%);
  }

  /* ─── Fade-out at end ─── */
  .stopmotion-intro.fade-out {
    animation: fadeOut 1s ease-out forwards;
  }
  @keyframes fadeOut {
    to { opacity: 0; pointer-events: none; }
  }

  /* ─── Responsive tweaks ─── */
  @media (max-width: 600px) {
    .header-img { width: 90%; }
    .sm-container { width: 95%; max-width: none; }
  }
</style>

<div class="stopmotion-intro" id="intro">
  <!-- 1️⃣ Hand-drawn header -->
  <img
    id="headerImg"
    class="header-img"
    src="/images/header%20text.png"
    alt="Hi! Please drop off all your WORRIES before entering"
  />

  <!-- 2️⃣ Stop-motion truck -->
  <div class="sm-container">
    <img
      id="smImg"
      class="sm-img"
      src="/images/truck.png"
      alt="hand-drawn dump truck"
    />
  </div>
</div>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const intro     = document.getElementById('intro');
    const headerImg = document.getElementById('headerImg');
    const smImg     = document.getElementById('smImg');

    // Only show once per session
    if (sessionStorage.getItem('introPlayed')) {
      intro.remove();
      return;
    }
    sessionStorage.setItem('introPlayed','true');

    // ─── 1️⃣ Header‐falling sequence ───
    const headerFrames    = [
      '/images/header%20text%20falling1.png',
      '/images/header%20text%20falling2.png'
    ];
    const headerFrameTime = 800;   // ms per frame
    const headerPause     = 500;   // ms pause after frames

    headerFrames.forEach((src, idx) => {
      setTimeout(() => {
        headerImg.src = src;
      }, idx * headerFrameTime);
    });

    // After the header frames + pause, start the truck
    const headerTotal = headerFrames.length * headerFrameTime + headerPause;
    setTimeout(() => {
      // ─── 2️⃣ Drive-in truck ───
      smImg.classList.add('drive-in');

      // ─── 3️⃣ Drop-worries sequence ───
      const dropFrames = [
        '/images/worries%20falling%20into%20truck.png',
        '/images/worries%20falling%20into%20truck-2.png',
        '/images/truck%20with%20worries.png'
      ];
      const dropInterval = 800;  // ms between drop frames
      const dropPause    = 300;  // ms pause after drive-in

      // begin dropping after drive-in duration + small pause
      setTimeout(() => {
        dropFrames.forEach((src, idx) => {
          setTimeout(() => {
            smImg.src = src;
          }, idx * dropInterval);
        });

        // ─── 4️⃣ Drive-out after all drops + 1s pause ───
        const totalDropTime = dropFrames.length * dropInterval;
        setTimeout(() => {
          smImg.classList.add('drive-out');

          // ─── 5️⃣ Fade intro 2s after drive-out ───
          setTimeout(() => {
            intro.classList.add('fade-out');
            setTimeout(() => intro.remove(), 1000);
          }, 2000);
        }, totalDropTime + 1000);

      }, 2000 + dropPause);

    }, headerTotal);
  });
</script>
