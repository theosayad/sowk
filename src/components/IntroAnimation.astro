---
/* IntroAnimation component */
---
<style>
  /* ─── page & container white ─── */
  html, body {
    margin: 0; padding: 0;
    background: #fff; height: 100%;
  }
  .stopmotion-intro {
    position: fixed; inset: 0;
    background: #fff;
    display: flex; flex-direction: column;
    align-items: center; gap: 1.5rem;
    padding: 2rem 1rem 1rem;
    overflow: hidden; z-index: 1000;
    box-sizing: border-box;
  }

  /* ─── header sizing ─── */
  .header-img {
    width: 80%; max-width: 600px;
    height: auto; display: block; z-index: 2;
  }

  /* ─── truck container ─── */
  .sm-container {
    position: relative;
    width: 90%; max-width: 500px;
    overflow: visible; z-index: 1;
  }
  .sm-img {
    display: block; width: 100%;
    transform: translateX(-120%);
  }
  .sm-img.drive-in {
    transition: transform 1.5s ease-out; /* now 1.5s */
    transform: translateX(0);
  }
  .sm-img.drive-out {
    transition: transform 2s ease-in;
    transform: translateX(120%);
  }

  /* ─── fade-out ─── */
  .stopmotion-intro.fade-out {
    animation: fadeOut 1s ease-out forwards;
  }
  @keyframes fadeOut {
    to { opacity: 0; pointer-events: none; }
  }

  /* ─── mobile ─── */
  @media (max-width: 600px) {
    .header-img { width: 90%; }
    .sm-container { width: 95%; max-width: none; }
  }
</style>

<div class="stopmotion-intro" id="intro">
  <!-- 1️⃣ header -->
  <img
    id="headerImg"
    class="header-img"
    src="/images/header%20text.png"
    alt="Hi! Please drop off all your WORRIES before entering"
  />

  <!-- 2️⃣ truck -->
  <div class="sm-container">
    <img
      id="smImg"
      class="sm-img"
      src="/images/truck.png"
      alt="hand-drawn dump truck"
    />
  </div>
</div>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const intro     = document.getElementById('intro');
    const headerImg = document.getElementById('headerImg');
    const smImg     = document.getElementById('smImg');

    if (sessionStorage.getItem('introPlayed')) {
      intro.remove();
      return;
    }
    sessionStorage.setItem('introPlayed','true');

    // start the truck drive-in immediately (1.5s)
    smImg.classList.add('drive-in');

    // header fall frames
    const headerFrames   = [
      '/images/header%20text%20falling1.png',
      '/images/header%20text%20falling2.png',
      '/images/header%20text%20worries%20fell.png'
    ];
    // drop-into-truck frames
    const dropFrames     = [
      '/images/worries%20falling%20into%20truck.png',
      '/images/worries%20falling%20into%20truck-2.png',
      '/images/truck%20with%20worries.png'
    ];

    const initialHold    = 1500; // ms to hold initial header
    const frameTime      = 800;  // ms between each frame
    const dropHold       = 1000; // ms hold after final drop

    // schedule header and drop frames in lock-step
    headerFrames.forEach((hsrc, i) => {
      setTimeout(() => headerImg.src = hsrc, initialHold + i * frameTime);
      setTimeout(() => smImg.src     = dropFrames[i], initialHold + i * frameTime);
    });

    const totalSequence = initialHold + headerFrames.length * frameTime; 
    // after all drops + dropHold, drive out
    setTimeout(() => {
      smImg.classList.add('drive-out');
      // fade out once drive-out completes (2s)
      setTimeout(() => {
        intro.classList.add('fade-out');
        setTimeout(() => intro.remove(), 1000);
      }, 2000);
    }, totalSequence + dropHold);

  });
</script>
