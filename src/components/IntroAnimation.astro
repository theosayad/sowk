---
/* IntroAnimation component: typewriter + sketchy dump-truck animation */
import { onMount } from 'solid-js';
---

<style>
  .intro-container {
    position: fixed;
    inset: 0;
    background: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  /* Typewriter effect */
  .typewriter {
    font-family: 'DM Sans', sans-serif;
    font-size: 2rem;
    white-space: nowrap;
    overflow: hidden;
    border-right: 2px solid #000;
    width: 0;
    animation: typing 3s steps(40) forwards, blink 0.75s step-end infinite;
    text-align: center;
    max-width: 90%;
  }
  @keyframes typing {
    from { width: 0; }
    to   { width: 40ch; }
  }
  @keyframes blink {
    50% { border-color: transparent; }
  }

  .truck-scene {
    position: relative;
    width: 300px;
    height: 180px;
    margin-top: 2rem;
  }

  /* Inline SVG sketchy truck */
  .truck-svg {
    display: block;
  }

  /* Dump bed rotation */
  @keyframes bed-tilt {
    0%   { transform: rotate(0deg); }
    50%  { transform: rotate(-45deg); }
    100% { transform: rotate(0deg); }
  }

  .letter {
    position: absolute;
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    font-size: 1.5rem;
    z-index: 2;
    opacity: 0;
    animation: drop 1s ease-out forwards;
  }
  @keyframes drop {
    from {
      transform: translate(0, 0);
      opacity: 1;
    }
    to {
      transform: translate(var(--dx), var(--dy));
      opacity: 1;
    }
  }
</style>

<div class="intro-container">
  <div class="typewriter">Hi there! From here onwards, please drop off all your worries and stresses.</div>

  <div class="truck-scene">
    <svg class="truck-svg" width="300" height="180">
      <!-- Truck body sketch -->
      <polyline points="10,150 10,90 220,90 220,60 280,60" 
                stroke="#000" stroke-width="3" fill="none" stroke-linecap="round" 
                stroke-linejoin="round" stroke-dasharray="4 2" />
      <!-- Wheels -->
      <circle cx="60" cy="155" r="20" stroke="#000" stroke-width="3" fill="none" stroke-dasharray="4 2" />
      <circle cx="200" cy="155" r="20" stroke="#000" stroke-width="3" fill="none" stroke-dasharray="4 2" />
      <!-- Dump bed group -->
      <g class="dump-bed" style="transform-origin: 220px 90px; animation: bed-tilt 2s ease-in-out 1 6s forwards;">
        <polyline points="10,100 10,60 180,60 180,100" 
                  stroke="#000" stroke-width="3" fill="none" stroke-linecap="round" 
                  stroke-linejoin="round" stroke-dasharray="4 2" />
      </g>
    </svg>

    {Array.from('worries stresses').map((char, i) => {
      const baseX = 60 + i * 12;
      const dx = `${baseX - 40}px`;
      return (
        <span
          class="letter"
          style={`left: ${baseX}px; top: 0px; --dx: ${dx}; --dy: 130px; animation-delay: ${3 + i * 0.1}s;`}
        >{char}</span>
      );
    })}
  </div>
</div>

<script is:inline>
  onMount(() => {
    // Remove the intro after animation completes
    setTimeout(() => {
      const root = document.querySelector('.intro-container');
      root?.remove();
    }, 9000);
  });
</script>
